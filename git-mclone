#!/bin/sh
# $Id: git-mclone,v 1.5 2017/12/20 20:22:13 friedman Exp $

case $1 in
    --bare   ) mode=$1 ; shift  ;;
    --mirror ) mode=$1 ; shift  ;;
    *        ) mode=--recursive ;;
esac

for url in "$@"; do
    localdir=${url##*/}
    localdir=${localdir%.git}.git  # make sure it ends in .git

    echo "** $url"
    git clone $mode -- "$url" "$localdir" || continue

    if [ -e "./$localdir/.git" ]; then
        (cd "./$localdir" && git-restore-commit-mtime)
    else # bare repo
        tm=`git -C "$localdir" log -n1 --format=tformat:%ci`
        find -- "$localdir" -exec touch -d "$tm" '{}' +
    fi
    echo
done

# eof
